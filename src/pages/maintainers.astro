---
import Layout from '../components/Layout.astro';
import ServiceCard from '../components/ServiceCard.astro';
import WishlistForm from '../components/WishlistForms.tsx';
import AuthenticatedForm from '../components/AuthenticatedForm.tsx';
import { getCollection } from 'astro:content';

const services = await getCollection('services');
const maintainerServices = services.filter(service => 
  service.data.target_audience === 'maintainer' || service.data.target_audience === 'both'
);

// Prepare services data for the form component
const servicesData = services.map(service => ({
  id: service.slug,
  title: service.data.title,
  description: service.data.description,
  tags: service.data.tags,
  slug: service.slug
}));

// Get user from middleware
const user = Astro.locals.user;
---

<Layout title="Services for Open Source Maintainers - OSS Wishlist" description="Practitioner services to help open source maintainers scale projects, build communities, and create sustainable funding.">
  <!-- Hero Section -->
  <section class="bg-gray-50 py-12" id="hero-section">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-5xl font-bold text-gray-900 mb-4" id="page-title">
          Create and Manage <span class="text-gray-600">Wishlists</span>
        </h1>
        <p class="text-gray-600 text-base" id="page-description">
          Choose from the provided list of GitHub repositories associated with your account or provide a different project URL. You may only create one wishlist per project.
          This will create a public issue in the <a href="https://github.com/oss-wishlist/wishlists/issues" target="_new">GitHub wishlists repository</a>. Private wishes are not yet available.
        </p>
      </div>
    </div>
  </section>

  <!-- Wishlist Form Section -->
  <section id="wishlist-form-section" class="py-4 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Wishlist Form Component with Auth -->
      <AuthenticatedForm client:load user={user}>
        <WishlistForm client:load services={servicesData} />
      </AuthenticatedForm>
    </div>
  </section>

</Layout>