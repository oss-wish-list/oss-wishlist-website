---
import Layout from '../../components/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const wishlists = await getCollection('wishlists');
  return wishlists.map((wishlist) => ({
    params: { id: wishlist.slug },
    props: { wishlist },
  }));
}

const { wishlist } = Astro.props;

const urgencyColors = {
  low: 'bg-green-100 text-green-800',
  medium: 'bg-yellow-100 text-yellow-800',
  high: 'bg-red-100 text-red-800',
  critical: 'bg-purple-100 text-purple-800'
};

const stageColors = {
  early: 'bg-blue-100 text-blue-800',
  growing: 'bg-green-100 text-green-800',
  mature: 'bg-gray-100 text-gray-800',
  established: 'bg-purple-100 text-purple-800'
};
---
<Layout title={`${wishlist.data.project_name} Wishlist - OSS Wishlist`} description={`Support ${wishlist.data.project_name}: ${wishlist.data.description}`}>
  <!-- Back Navigation -->
  <div class="bg-gray-50 py-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <a href={`${import.meta.env.BASE_URL}/wishlists`} class="text-gray-600 hover:text-gray-700 flex items-center">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        Back to Wishlists
      </a>
    </div>
  </div>

  <!-- Project Header -->
  <section class="py-12 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid md:grid-cols-3 gap-8">
        <div class="md:col-span-2">
          <div class="flex items-start space-x-4 mb-6">
            <img src="/oss-wish.webp" alt={wishlist.data.project_name} class="w-16 h-16 rounded-lg" />
            <div class="flex-1">
              <h1 class="text-4xl font-bold text-gray-900 mb-2">{wishlist.data.project_name}</h1>
              <p class="text-lg text-gray-600 mb-4">@{wishlist.data.maintainer.username}</p>
              
              <div class="flex flex-wrap gap-3 mb-4">
                <span class={`px-3 py-1 text-sm rounded-full ${urgencyColors[wishlist.data.urgency]}`}>
                  {wishlist.data.urgency} priority
                </span>
                <span class={`px-3 py-1 text-sm rounded-full ${stageColors[wishlist.data.project_stage]}`}>
                  {wishlist.data.project_stage}
                </span>
                <span class="px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-800">
                  {wishlist.data.license}
                </span>
              </div>
              
              <!-- Project Stats -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                <div>
                  <span class="text-gray-600">GitHub Stars</span>
                  <div class="font-semibold">{wishlist.data.github_stars?.toLocaleString() || 'N/A'}</div>
                </div>
                <div>
                  <span class="text-gray-600">Monthly Downloads</span>
                  <div class="font-semibold">{wishlist.data.monthly_downloads || 'N/A'}</div>
                </div>
                <div>
                  <span class="text-gray-600">Technologies</span>
                  <div class="font-semibold">{wishlist.data.technologies?.slice(0, 2).join(', ')}</div>
                </div>
                <div>
                  <span class="text-gray-600">Stage</span>
                  <div class="font-semibold">{wishlist.data.project_stage}</div>
                </div>
              </div>
            </div>
          </div>
          
          <p class="text-lg text-gray-700 mb-6">{wishlist.data.description}</p>
          
          <div class="prose prose-lg max-w-none prose-headings:text-gray-900 prose-h2:text-xl prose-h2:font-bold prose-h2:mb-4 prose-h2:mt-8 prose-h3:text-lg prose-h3:font-semibold prose-h3:mb-3 prose-h3:mt-6 prose-p:text-gray-700 prose-ul:text-gray-700 prose-li:mb-2">
            <div set:html={wishlist.body} />
          </div>
        </div>
        
        <!-- Support CTA Sidebar -->
        <div class="bg-gray-50 p-6 rounded-lg h-fit">
          <h2 class="text-xl font-bold text-gray-900 mb-4">Support This Project</h2>
          
          <div class="mb-6">
            <div class="text-sm text-gray-600 mb-1">Budget Range</div>
            <div class="text-2xl font-bold text-green-600">{wishlist.data.budget_range || 'To be discussed'}</div>
          </div>
          
          <div class="space-y-3 mb-6">
            <a 
              href={`mailto:${wishlist.data.maintainer.email}?subject=Support for ${wishlist.data.project_name}&body=Hi! I'm interested in supporting your project. Let's discuss how I can help.`}
              class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors text-center block font-semibold"
            >
              Contact to Support
            </a>
            <a 
              href={wishlist.data.repo_url}
              target="_blank"
              rel="noopener noreferrer"
              class="w-full border border-gray-300 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors text-center block"
            >
              View on GitHub
            </a>
                target="_blank"
                rel="noopener noreferrer"
                class="w-full border border-gray-300 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors text-center block"
              >
                Visit Website
              </a>
            )}
          </div>
          
          <!-- Contact Methods -->
          <div class="border-t pt-4">
            <h3 class="font-semibold text-gray-900 mb-3">Contact</h3>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">Email</span>
                <a href={`mailto:${wishlist.data.maintainer.email}`} class="text-gray-600 hover:text-gray-700">{wishlist.data.maintainer.email}</a>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">GitHub</span>
                <a href={`https://github.com/${wishlist.data.maintainer.username}`} target="_blank" rel="noopener noreferrer" class="text-gray-600 hover:text-gray-700">@{wishlist.data.maintainer.username}</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Needed -->
  <section class="py-12 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-8">Services Needed</h2>
      
      <div class="grid md:grid-cols-2 gap-6">
        {wishlist.data.services_needed.map(service => (
          <div class="bg-white p-6 rounded-lg border shadow-sm">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">{service}</h3>
          </div>
        ))}
      </div>
    </div>
  </section>
                {metric}
              </li>
            ))}
          </ul>
          
          <h3 class="text-xl font-semibold text-gray-900 mb-4">Recent Achievements</h3>
          <ul class="space-y-3">
            {wishlist.recent_achievements.map(achievement => (
              <li class="flex items-center text-gray-700">
                <svg class="w-5 h-5 text-gray-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                {achievement}
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Tags -->
  <section class="py-8 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-wrap gap-2">
        {wishlist.tags.map(tag => (
          <span class="px-3 py-1 bg-white text-gray-700 text-sm rounded border">{tag}</span>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-12 bg-blue-600">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl font-bold text-white mb-4">Ready to Support {wishlist.project_name}?</h2>
      <p class="text-xl text-blue-100 mb-8">Get in touch to discuss how you can help make this project thrive</p>
      <div class="flex justify-center space-x-4">
        <a 
          href={`mailto:${wishlist.contact_email}?subject=Support for ${wishlist.project_name}`}
          class="bg-white text-gray-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors"
        >
          Contact Maintainer
        </a>
        <a href={`${import.meta.env.BASE_URL}/wishlists`} class="border border-orange-300 text-white px-8 py-3 rounded-lg font-semibold hover:bg-orange-700 transition-colors">
          Browse Other Projects
        </a>
      </div>
    </div>
  </section>
</Layout>